<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iscrizione Lezione</title>
<style>
body { background: #1a1a1a; color: #f3f3f3; font-family: Arial, sans-serif; }
main { max-width: 500px; margin: 2em auto; background: #23272b; padding: 2em; border-radius: 12px; box-shadow: 0 2px 16px rgba(0,0,0,0.15); }
label { display:block; margin-top:1em; color:#60a5fa; }
input { width:100%; padding:0.7em; margin-top:0.3em; border-radius:6px; border:1px solid #2563eb; background:#181a1b; color:#f3f3f3; font-size:1em; }
button { margin-top:1.5em; padding:1em 2em; background:#2563eb; color:#fff; border:none; border-radius:8px; font-size:1.1em; cursor:pointer; transition:background 0.2s; }
button:hover { background:#1d4ed8; }
.inscription-preview { margin-top:2em; background:#181a1b; padding:1em; border-radius:8px; color:#fff; }
</style>
</head>
<body>
<main>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em;">
  <h1 style="margin: 0;">Iscrizione alla Lezione</h1>
  <button onclick="window.location.href='index.html'" style="padding: 0.7em 1.5em; background: #2563eb; color: #fff; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: bold; transition: background 0.2s; margin-top: 0;">
    ← Indietro
  </button>
</div>

<div id="firebase-status" style="margin-bottom:1em; font-weight:bold;"></div>

<!-- Hidden iframe to submit without leaving the page -->
<iframe name="hidden_iframe" style="display:none;"></iframe>

<form id="inscription-form">
  <label for="firstname">Nome</label>
  <input type="text" id="firstname" name="FirstName" required>

  <label for="lastname">Cognome</label>
  <input type="text" id="lastname" name="LastName" required>

  <label for="birthyear">Anno di nascita</label>
  <input type="number" id="birthyear" name="BirthYear" required min="1900" max="2026" placeholder="es. 2005">

  <label for="phone">Telefono</label>
  <input type="tel" id="phone" name="Phone" required
         pattern="^\+\d{6,15}$|^\+\d{1,4}[\s\d]{5,}$"
         placeholder="+41 79 123 45 67"
         title="Inserisci il numero in formato internazionale, es: +41 79 123 45 67">

  <label for="email">Email (opzionale)</label>
  <input type="email" id="email" name="Email" placeholder="nome@email.com">

  <button type="submit">Iscriviti</button>
</form>

<div class="inscription-preview" id="inscription-preview" style="display:none;">
  <h3>Anteprima iscrizione:</h3>
  <p id="preview-content"></p>
</div>
</main>

<!-- Add Firebase SDKs -->
<script src="firebase-config.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
<script>
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const form = document.getElementById('inscription-form');
  const preview = document.getElementById('inscription-preview');
  const previewContent = document.getElementById('preview-content');
  const statusDiv = document.getElementById('firebase-status');

  // Remove the connection check that requires read permissions
  statusDiv.textContent = "✅ Pronto per l'iscrizione.";
  statusDiv.style.color = "#22c55e";

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const firstname = form.FirstName.value;
    const lastname = form.LastName.value;
    const birthyear = form.BirthYear.value;
    const phone = form.Phone.value;
    const email = form.Email.value;

    previewContent.innerHTML = `
      <strong>Nome:</strong> ${firstname}<br>
      <strong>Cognome:</strong> ${lastname}<br>
      <strong>Anno di nascita:</strong> ${birthyear}<br>
      <strong>Telefono:</strong> ${phone}<br>
      <strong>Email:</strong> ${email ? email : '-'}
    `;
    preview.style.display = 'block';

    db.collection("iscrizioni").add({
      FirstName: firstname,
      LastName: lastname,
      BirthYear: birthyear,
      Phone: phone,
      Email: email
    })
    .then(() => {
      statusDiv.textContent = "✅ Dati inviati correttamente al db!";
      statusDiv.style.color = "#22c55e";
      alert('Iscrizione inviata con successo!');
      setTimeout(() => {
        form.reset();
        preview.style.display = 'none';
      }, 500);
    })
    .catch((error) => {
      statusDiv.textContent = "❌ Errore nell'invio dei dati: " + error.message;
      statusDiv.style.color = "#f87171";
      alert('Errore nell\'invio: ' + error.message);
    });
  });
</script>
</body>
</html>
