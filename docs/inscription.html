<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iscrizione Lezione</title>
<style>
body { background: #1a1a1a; color: #f3f3f3; font-family: Arial, sans-serif; }
main { max-width: 500px; margin: 2em auto; background: #23272b; padding: 2em; border-radius: 12px; box-shadow: 0 2px 16px rgba(0,0,0,0.15); }
label { display:block; margin-top:1em; color:#60a5fa; }
input { width:100%; padding:0.7em; margin-top:0.3em; border-radius:6px; border:1px solid #2563eb; background:#181a1b; color:#f3f3f3; font-size:1em; }
button { margin-top:1.5em; padding:1em 2em; background:#2563eb; color:#fff; border:none; border-radius:8px; font-size:1.1em; cursor:pointer; transition:background 0.2s; }
button:hover { background:#1d4ed8; }
.inscription-preview { margin-top:2em; background:#181a1b; padding:1em; border-radius:8px; color:#fff; }
</style>
</head>
<body>
<main>
<h1>Iscrizione alla Lezione</h1>

<div id="firebase-status" style="margin-bottom:1em; font-weight:bold;"></div>

<!-- Hidden iframe to submit without leaving the page -->
<iframe name="hidden_iframe" style="display:none;"></iframe>

<form id="inscription-form">
  <label for="firstname">Nome</label>
  <input type="text" id="firstname" name="FirstName" required>

  <label for="lastname">Cognome</label>
  <input type="text" id="lastname" name="LastName" required>

  <label for="phone">Telefono</label>
  <input type="tel" id="phone" name="Phone" required
         pattern="^\+\d{6,15}$|^\+\d{1,4}[\s\d]{5,}$"
         placeholder="+41 79 123 45 67"
         title="Inserisci il numero in formato internazionale, es: +41 79 123 45 67">

  <label for="email">Email (opzionale)</label>
  <input type="email" id="email" name="Email" placeholder="nome@email.com">

  <button type="submit">Iscriviti</button>
</form>

<div class="inscription-preview" id="inscription-preview" style="display:none;">
  <h3>Anteprima iscrizione:</h3>
  <p id="preview-content"></p>
</div>
</main>

<!-- Add Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
<script>
  // Firebase configuration constants
  const FIREBASE_API_KEY = "AIzaSyC7u5MyVWVh8f_kSaE_q445jS5O5Qw0WPo";
  const FIREBASE_AUTH_DOMAIN = "institute-b877c.firebaseapp.com";
  const FIREBASE_PROJECT_ID = "institute-b877c";
  const FIREBASE_STORAGE_BUCKET = "institute-b877c.appspot.com";
  const FIREBASE_MESSAGING_SENDER_ID = "1035260652216";
  const FIREBASE_APP_ID = "1:1035260652216:web:a275c0bfb35ef48627224d";
  const FIREBASE_MEASUREMENT_ID = "G-98B5FH2ZEH";

  const firebaseConfig = {
    apiKey: FIREBASE_API_KEY,
    authDomain: FIREBASE_AUTH_DOMAIN,
    projectId: FIREBASE_PROJECT_ID,
    storageBucket: FIREBASE_STORAGE_BUCKET,
    messagingSenderId: FIREBASE_MESSAGING_SENDER_ID,
    appId: FIREBASE_APP_ID,
    measurementId: FIREBASE_MEASUREMENT_ID
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const form = document.getElementById('inscription-form');
  const preview = document.getElementById('inscription-preview');
  const previewContent = document.getElementById('preview-content');

  // Check Firebase connection
  const statusDiv = document.getElementById('firebase-status');
  db.collection("iscrizioni").limit(1).get()
    .then(() => {
      statusDiv.textContent = "✅ Connessione db riuscita.";
      statusDiv.style.color = "#22c55e";
    })
    .catch((error) => {
      statusDiv.textContent = "❌ Errore connessione db: " + error.message;
      statusDiv.style.color = "#f87171";
    });

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const firstname = form.FirstName.value;
    const lastname = form.LastName.value;
    const phone = form.Phone.value;
    const email = form.Email.value;

    previewContent.innerHTML = `
      <strong>Nome:</strong> ${firstname}<br>
      <strong>Cognome:</strong> ${lastname}<br>
      <strong>Telefono:</strong> ${phone}<br>
      <strong>Email:</strong> ${email ? email : '-'}
    `;
    preview.style.display = 'block';

    db.collection("iscrizioni").add({
      FirstName: firstname,
      LastName: lastname,
      Phone: phone,
      Email: email
    })
    .then(() => {
      statusDiv.textContent = "✅ Dati inviati correttamente al db!";
      statusDiv.style.color = "#22c55e";
      alert('Iscrizione inviata con successo!');
      setTimeout(() => form.reset(), 500);
    })
    .catch((error) => {
      statusDiv.textContent = "❌ Errore nell'invio dei dati: " + error.message;
      statusDiv.style.color = "#f87171";
      alert('Errore nell\'invio: ' + error.message);
    });
  });
</script>
</body>
</html>
